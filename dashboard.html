<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0; maximum-scale=1.0; user-scalable=no">
    <title>Painel - ShapeCoin Premium</title>
    <style>
        /* --- TEMA PREMIUM --- */
        :root {
            --primary: #00ff9d;       /* Verde Menta Neon */
            --gold: #ffd700;          /* Dourado Principal */
            --gold-dark: #b8860b;     /* Dourado Escuro */
            --bg-deep: #050505;       /* Preto Quase Puro */
            --text-light: #ffffff;
            --text-dim: #a0a0a0;
            --glass-bg: rgba(255, 255, 255, 0.05); /* Vidro */
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            background-color: var(--bg-deep);
            /* Fundo sutil com gradiente para profundidade */
            background-image: radial-gradient(circle at top right, rgba(0, 255, 157, 0.1), transparent 40%),
                              radial-gradient(circle at bottom left, rgba(255, 215, 0, 0.05), transparent 40%);
            color: var(--text-light);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            padding-bottom: 110px; /* Espa√ßo para o banner flutuante */
        }
        
        /* CABE√áALHO DE LUXO */
        .header {
            display: flex; justify-content: space-between; align-items: center;
            padding-bottom: 25px; margin-bottom: 30px;
            border-bottom: 1px solid var(--glass-border);
        }
        .user-info span { color: var(--text-dim); font-size: 0.9rem; letter-spacing: 1px; text-transform: uppercase; }
        .user-info h2 { margin: 5px 0 0 0; font-size: 1.5rem; font-weight: 700; background: linear-gradient(to right, #fff, #aaa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* O DISTINTIVO DE OURO */
        .coin-badge {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            padding: 12px 25px; border-radius: 50px;
            color: #000; font-weight: 900; font-size: 1.3rem;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3); /* Brilho Dourado */
            display: flex; align-items: center; gap: 8px;
            text-shadow: 0 1px 2px rgba(255,255,255,0.4);
        }

        /* CART√ïES DE VIDRO (GLASSMORPHISM) */
        .card {
            background: var(--glass-bg);
            backdrop-filter: blur(12px); /* O efeito de desfoque */
            -webkit-backdrop-filter: blur(12px);
            padding: 25px;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            margin-bottom: 25px;
            max-width: 600px; margin-left: auto; margin-right: auto;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3); /* Sombra suave */
            transition: transform 0.3s ease;
        }
        .card:hover { transform: translateY(-2px); } /* Leve flutuada ao passar o mouse */

        /* T√çTULOS ELEGANTES */
        h3 {
            color: var(--primary); margin-top: 0; font-weight: 700;
            text-transform: uppercase; letter-spacing: 2px; font-size: 0.9rem;
            border-bottom: 1px solid var(--glass-border); padding-bottom: 15px; margin-bottom: 20px;
            display: flex; align-items: center;
        }
        h3::before { content: ''; display: inline-block; width: 8px; height: 8px; background: var(--primary); border-radius: 50%; margin-right: 10px; box-shadow: 0 0 10px var(--primary); }

        /* INPUTS E SELECTS MODERNOS */
        input, select {
            width: 100%; padding: 16px; margin: 10px 0;
            background: rgba(0,0,0,0.3); /* Fundo mais escuro que o card */
            border: 1px solid var(--glass-border); color: white; border-radius: 12px;
            font-size: 16px; box-sizing: border-box; transition: 0.3s;
            appearance: none; /* Remove estilo padr√£o do navegador */
        }
        input:focus, select:focus { border-color: var(--primary); box-shadow: 0 0 15px rgba(0, 255, 157, 0.2); outline: none; }
        input::placeholder { color: #666; }

        /* Layout de Colunas */
        .row { display: flex; gap: 15px; }
        .row input { width: 50%; }

        /* BOT√ÉO PRINCIPAL (NEON) */
        button {
            width: 100%; padding: 18px; margin-top: 15px;
            background: linear-gradient(to right, var(--primary), #00cc7a);
            color: #000; font-weight: 800; border: none; border-radius: 12px;
            cursor: pointer; text-transform: uppercase; letter-spacing: 1.5px; font-size: 14px;
            transition: 0.3s; box-shadow: 0 4px 15px rgba(0, 255, 157, 0.3);
        }
        button:hover { transform: scale(1.02); box-shadow: 0 6px 20px rgba(0, 255, 157, 0.5); }
        button:disabled { background: #333; color: #666; box-shadow: none; cursor: not-allowed; }

        /* CARD B√îNUS (EDI√á√ÉO OURO) */
        .card-gold { border-color: rgba(255, 215, 0, 0.3); background: rgba(255, 215, 0, 0.03); }
        .card-gold h3 { color: var(--gold); }
        .card-gold h3::before { background: var(--gold); box-shadow: 0 0 10px var(--gold); }
        
        .btn-bonus {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark), var(--gold));
            background-size: 200% auto;
            color: black; animation: shine 3s infinite linear; border: none;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }
        @keyframes shine { to { background-position: 200% center; } }

        /* RESULTADO IMC */
        .imc-result { text-align: center; margin-top: 20px; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 15px; display: none; border: 1px solid var(--glass-border); }
        .imc-value { font-size: 2.5rem; font-weight: 900; color: var(--primary); display: block; text-shadow: 0 0 15px rgba(0,255,157,0.3); }
        .imc-status { color: var(--text-dim); font-size: 1rem; margin-top: 5px; text-transform: uppercase; letter-spacing: 1px; }

        /* HIST√ìRICO */
        .history-item {
            display: flex; justify-content: space-between; padding: 18px;
            background: rgba(255,255,255,0.03); margin-bottom: 10px; border-radius: 12px;
            border-left: 4px solid var(--primary); align-items: center;
        }
        .history-type { font-weight: 600; }
        .gain-pill { background: rgba(0, 255, 157, 0.15); color: var(--primary); padding: 5px 12px; border-radius: 20px; font-weight: 700; font-size: 0.9rem; }

        /* BANNER FLUTUANTE PREMIUM */
        .sticky-banner {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 500px;
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            padding: 12px 20px; text-align: center; cursor: pointer; z-index: 100;
            border-radius: 50px; display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .banner-cta { background: var(--primary); color: black; padding: 8px 20px; border-radius: 30px; font-weight: 800; font-size: 0.8rem; letter-spacing: 1px; }
    </style>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>

    <div class="header">
        <div class="user-info">
            <span>Bem-vindo,</span>
            <h2 id="userEmail">Carregando...</h2>
        </div>
        <div class="coin-badge">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 3h12l4 6-10 13L2 9Z"/><path d="M11 3 8 9l4 13 4-13-3-6"/></svg>
            <span id="coinBalance">...</span>
        </div>
    </div>

    <div class="card">
        <h3>Dados Corporais</h3>
        <label style="color: var(--text-dim); font-size: 0.8rem; margin-left: 5px;">Nascimento</label>
        <input type="date" id="birthDate" style="color-scheme: dark;">
        <div class="row">
            <input type="text" id="weight" placeholder="Peso (kg)">
            <input type="tel" id="height" placeholder="Altura (cm)">
        </div>
        <button onclick="salvarPerfil()" id="btnSalvarPerfil" style="background: transparent; border: 2px solid var(--primary); color: var(--primary);">Atualizar & Calcular IMC</button>

        <div id="imcBox" class="imc-result">
            <span id="imcValue" class="imc-value">0.00</span>
            <span id="imcStatus" class="imc-status">Calculando...</span>
        </div>
    </div>

    <div class="card card-gold">
        <h3>B√¥nus Di√°rio</h3>
        <p style="color:var(--text-dim); font-size: 0.9rem; margin-bottom: 20px;">Assista e ganhe. Limite: <span id="bonusCount" style="color:var(--gold); font-weight:bold;">0</span>/10 hoje.</p>
        <button onclick="assistirBonus()" id="btnBonus" class="btn-bonus">
            RESGATAR +20 SC
        </button>
    </div>

    <div class="card">
        <h3>Registrar Atividade</h3>
        <p style="color:var(--text-dim); font-size: 0.8rem; margin-bottom: 15px;">Regra: M√°x 2 treinos/dia. Intervalo de 2h.</p>
        
        <select id="workoutType">
            <option value="Superior">üèãÔ∏è Treino Superior</option>
            <option value="Inferior">ü¶ø Treino Inferior</option>
            <option value="Cardio">üèÉ Cardio / Corrida</option>
            <option value="Crossfit">üî• Crossfit / Funcional</option>
        </select>
        <select id="intensity">
            <option value="50">N√≠vel Normal (+50 SC)</option>
            <option value="80">N√≠vel Pesado (+80 SC)</option>
        </select>
        <button onclick="salvarTreino()" id="btnTreinar">VALIDAR TREINO</button>
    </div>

    <div class="card">
        <h3>√öltimas Movimenta√ß√µes</h3>
        <div id="historyList">
            <p style="color: var(--text-dim); text-align: center;">Carregando...</p>
        </div>
    </div>

    <div style="text-align: center; margin: 30px 0;">
        <button onclick="sair()" style="background: transparent; border: 1px solid #333; color: var(--text-dim); width: auto; padding: 12px 40px;">Sair da Conta</button>
    </div>

    <div class="sticky-banner" onclick="abrirLinkAds()">
        <span style="color: #fff; font-weight: 600; font-size: 0.9rem;">Oferta Exclusiva</span>
        <div class="banner-cta">VER AGORA ‚Üí</div>
    </div>

    <script>
        const LINK_ADS = "https://google.com"; 

        const firebaseConfig = {
            apiKey: "AIzaSyANh5g4EathHhB0cY4he_CTmdyLUm_TFuE",
            authDomain: "shapecoin.firebaseapp.com",
            projectId: "shapecoin",
            storageBucket: "shapecoin.firebasestorage.app",
            messagingSenderId: "365582210645",
            appId: "1:365582210645:web:8bf24f3809815340be66dc"
        };

        try {
            firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            const db = firebase.firestore();
            let currentUser = null;

            auth.onAuthStateChanged((user) => {
                if (!user) window.location.href = "index.html";
                else {
                    currentUser = user;
                    document.getElementById('userEmail').innerText = user.email.split('@')[0];
                    carregarDadosIniciais();
                }
            });

            function carregarDadosIniciais() {
                db.collection("users").doc(currentUser.uid).onSnapshot((doc) => {
                    if (doc.exists) {
                        const data = doc.data();
                        // Formata o saldo com ponto se for milhar (ex: 1.200)
                        document.getElementById('coinBalance').innerText = (data.coins || 0).toLocaleString('pt-BR');
                        
                        const hoje = new Date().toDateString();
                        const lastBonusDate = data.lastBonusDate ? data.lastBonusDate.toDate().toDateString() : "";
                        
                        if(lastBonusDate === hoje) {
                            document.getElementById('bonusCount').innerText = data.dailyBonusCount || 0;
                        } else {
                            document.getElementById('bonusCount').innerText = 0;
                        }

                        if(data.weight) document.getElementById('weight').value = data.weight;
                        if(data.height) document.getElementById('height').value = data.height;
                        if(data.birthDate) document.getElementById('birthDate').value = data.birthDate;
                        if(data.weight && data.height) calcularIMC(data.weight, data.height);
                    }
                });
                carregarHistorico();
            }

            async function salvarTreino() {
                const btn = document.getElementById('btnTreinar');
                const type = document.getElementById('workoutType').value;
                const value = parseInt(document.getElementById('intensity').value);
                btn.disabled = true; btn.innerText = "VERIFICANDO...";
                try {
                    const userRef = db.collection("users").doc(currentUser.uid);
                    const doc = await userRef.get();
                    const data = doc.data() || {};
                    const hoje = new Date().toDateString();
                    const lastTrainDate = data.lastTrainDate ? data.lastTrainDate.toDate() : null;
                    const lastTrainDayStr = lastTrainDate ? lastTrainDate.toDateString() : "";
                    let dailyTrainCount = (lastTrainDayStr === hoje) ? (data.dailyTrainCount || 0) : 0;

                    if (dailyTrainCount >= 2) { alert("‚ö†Ô∏è Limite di√°rio de 2 treinos atingido."); btn.disabled = false; btn.innerText = "VALIDAR TREINO"; return; }
                    if (lastTrainDate) {
                        const diffTime = new Date() - lastTrainDate;
                        if (diffTime < 7200000) { 
                            const faltaMin = Math.ceil((7200000 - diffTime) / 60000);
                            alert(`‚è≥ Aguarde ${faltaMin} minutos para o pr√≥ximo treino.`);
                            btn.disabled = false; btn.innerText = "VALIDAR TREINO"; return;
                        }
                    }
                    await userRef.set({
                        coins: firebase.firestore.FieldValue.increment(value),
                        lastTrainDate: firebase.firestore.FieldValue.serverTimestamp(),
                        dailyTrainCount: (lastTrainDayStr === hoje) ? dailyTrainCount + 1 : 1
                    }, { merge: true });
                    await db.collection("history").add({ userId: currentUser.uid, type: type, value: value, date: firebase.firestore.FieldValue.serverTimestamp() });
                    alert(`‚úÖ +${value} SC creditados com sucesso!`);
                    btn.innerText = "VALIDAR TREINO"; btn.disabled = false;
                } catch (error) { alert("Erro: " + error.message); btn.disabled = false; }
            }

            async function assistirBonus() {
                const btn = document.getElementById('btnBonus');
                btn.disabled = true;
                try {
                    const userRef = db.collection("users").doc(currentUser.uid);
                    const doc = await userRef.get();
                    const data = doc.data() || {};
                    const hoje = new Date().toDateString();
                    const lastBonusDayStr = data.lastBonusDate ? data.lastBonusDate.toDate().toDateString() : "";
                    let dailyBonusCount = (lastBonusDayStr === hoje) ? (data.dailyBonusCount || 0) : 0;

                    if (dailyBonusCount >= 10) { alert("‚ö†Ô∏è Limite de b√¥nus di√°rio atingido."); btn.disabled = false; return; }
                    window.open(LINK_ADS, '_blank');
                    setTimeout(async () => {
                        await userRef.set({
                            coins: firebase.firestore.FieldValue.increment(20),
                            lastBonusDate: firebase.firestore.FieldValue.serverTimestamp(),
                            dailyBonusCount: (lastBonusDayStr === hoje) ? dailyBonusCount + 1 : 1
                        }, { merge: true });
                        await db.collection("history").add({ userId: currentUser.uid, type: "üéÅ B√¥nus Di√°rio", value: 20, date: firebase.firestore.FieldValue.serverTimestamp() });
                        alert(`üí∞ +20 SC Recebidos!`);
                        btn.disabled = false;
                    }, 5000);
                } catch (e) { btn.disabled = false; }
            }

            window.salvarPerfil = function() {
                const btn = document.getElementById('btnSalvarPerfil');
                let weightStr = document.getElementById('weight').value.replace(',', '.');
                let heightStr = document.getElementById('height').value.replace(',', '.');
                const weight = parseFloat(weightStr);
                const height = parseFloat(heightStr);
                const birthDate = document.getElementById('birthDate').value;
                if(isNaN(weight) || isNaN(height)) { alert("Digite Peso e Altura v√°lidos"); return; }
                btn.innerText = "SALVANDO...";
                db.collection("users").doc(currentUser.uid).set({ weight: weight, height: height, birthDate: birthDate }, { merge: true })
                .then(() => { calcularIMC(weight, height); btn.innerText = "DADOS ATUALIZADOS"; setTimeout(() => btn.innerText = "Atualizar & Calcular IMC", 2000); });
            };

            function calcularIMC(peso, alturaCm) {
                const imc = peso / ((alturaCm / 100) ** 2);
                document.getElementById('imcBox').style.display = 'block';
                document.getElementById('imcValue').innerText = imc.toFixed(2);
                const stat = document.getElementById('imcStatus');
                if(imc < 18.5) { stat.innerText = "Abaixo do peso"; stat.style.color = "#ffd700"; }
                else if(imc < 24.9) { stat.innerText = "Peso Normal ‚úÖ"; stat.style.color = "#00ff9d"; }
                else if(imc < 29.9) { stat.innerText = "Sobrepeso"; stat.style.color = "orange"; }
                else { stat.innerText = "Obesidade"; stat.style.color = "#ff4444"; }
            }

            function carregarHistorico() {
                db.collection("history").where("userId", "==", currentUser.uid).orderBy("date", "desc").limit(5).onSnapshot((snap) => {
                    const list = document.getElementById('historyList');
                    list.innerHTML = "";
                    snap.forEach((doc) => {
                        const d = doc.data();
                        // Remove emojis do hist√≥rico para ficar limpo
                        const tipoLimpo = d.type.replace(/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{1F1E0}-\u{1F1FF}\u{2702}-\u{27B0}\u{24C2}-\u{1F9FF}]/gu, '').trim();
                        list.innerHTML += `<div class="history-item"><span class="history-type">${tipoLimpo}</span><span class="gain-pill">+${d.value} SC</span></div>`;
                    });
                });
            }
            
            window.abrirLinkAds = function() { window.open(LINK_ADS, '_blank'); };
            window.sair = function() { auth.signOut().then(() => window.location.href = "index.html"); };

        } catch (e) { alert("Erro Cr√≠tico: " + e.message); }
    </script>
</body>
</html>
